{"ast":null,"code":"import _regeneratorRuntime from \"/Users/dmitrijponomarev/Desktop/1337/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/dmitrijponomarev/Desktop/1337/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nvar o = function o(e) {\n    var a = \"=\".repeat((4 - e.length % 4) % 4),\n      r = (e + a).replace(/-/g, \"+\").replace(/_/g, \"/\"),\n      t = window.atob(r),\n      n = new Uint8Array(t.length);\n    for (var i = 0; i < t.length; ++i) n[i] = t.charCodeAt(i);\n    return n;\n  },\n  s = function s(_ref) {\n    var e = _ref.publicKey;\n    return {\n      getSubscription: function () {\n        var _getSubscription = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n          var r, n;\n          return _regeneratorRuntime().wrap(function _callee$(_context) {\n            while (1) switch (_context.prev = _context.next) {\n              case 0:\n                if (!(!(\"serviceWorker\" in navigator) || !(\"PushManager\" in window))) {\n                  _context.next = 2;\n                  break;\n                }\n                throw {\n                  errorCode: \"ServiceWorkerAndPushManagerNotSupported\"\n                };\n              case 2:\n                _context.next = 4;\n                return navigator.serviceWorker.ready;\n              case 4:\n                r = _context.sent;\n                if (r.pushManager) {\n                  _context.next = 7;\n                  break;\n                }\n                throw {\n                  errorCode: \"PushManagerUnavailable\"\n                };\n              case 7:\n                _context.next = 9;\n                return r.pushManager.getSubscription();\n              case 9:\n                if (!_context.sent) {\n                  _context.next = 11;\n                  break;\n                }\n                throw {\n                  errorCode: \"ExistingSubscription\"\n                };\n              case 11:\n                n = o(e);\n                _context.next = 14;\n                return r.pushManager.subscribe({\n                  applicationServerKey: n,\n                  userVisibleOnly: !0\n                });\n              case 14:\n                return _context.abrupt(\"return\", _context.sent);\n              case 15:\n              case \"end\":\n                return _context.stop();\n            }\n          }, _callee);\n        }));\n        function getSubscription() {\n          return _getSubscription.apply(this, arguments);\n        }\n        return getSubscription;\n      }()\n    };\n  };\nexport { s as useSubscribe };","map":{"version":3,"names":["o","e","a","repeat","length","r","replace","t","window","atob","n","Uint8Array","i","charCodeAt","s","_ref","publicKey","getSubscription","_getSubscription","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","navigator","errorCode","serviceWorker","ready","sent","pushManager","subscribe","applicationServerKey","userVisibleOnly","abrupt","stop","apply","arguments"],"sources":["/Users/dmitrijponomarev/Desktop/1337/client/node_modules/react-pwa-push-notifications/src/hooks/useSubscribe.ts"],"sourcesContent":["const urlBase64ToUint8Array = (base64String: string): Uint8Array => {\n    const padding = '='.repeat((4 - base64String.length % 4) % 4);\n    const base64 = (base64String + padding)\n        .replace(/-/g, '+')\n        .replace(/_/g, '/');\n\n    const rawData = window.atob(base64);\n    const outputArray = new Uint8Array(rawData.length);\n\n    for (let i = 0; i < rawData.length; ++i) {\n        outputArray[i] = rawData.charCodeAt(i);\n    }\n\n    return outputArray;\n};\n\nexport enum Errors {\n    ServiceWorkerAndPushManagerNotSupported = \"ServiceWorkerAndPushManagerNotSupported\",\n    PushManagerUnavailable = \"PushManagerUnavailable\",\n    ExistingSubscription = \"ExistingSubscription\",\n    Unknown = \"Unknown\"\n}\n\ninterface SubscribeProps {\n    publicKey: string;\n}\n\ninterface ErrorObject {\n    errorCode: Errors;\n}\n\nexport const useSubscribe = ({ publicKey }: SubscribeProps) => {\n    const getSubscription = async (): Promise<PushSubscription> => {\n        if (!('serviceWorker' in navigator) || !('PushManager' in window)) {\n            throw { errorCode: Errors.ServiceWorkerAndPushManagerNotSupported } as ErrorObject;\n        }\n\n        const registration = await navigator.serviceWorker.ready;\n\n        if (!registration.pushManager) {\n            throw { errorCode: Errors.PushManagerUnavailable } as ErrorObject;\n        }\n\n        const existingSubscription = await registration.pushManager.getSubscription();\n\n        if (existingSubscription) {\n            throw { errorCode: Errors.ExistingSubscription } as ErrorObject;\n        }\n\n        const convertedVapidKey = urlBase64ToUint8Array(publicKey);\n        return await registration.pushManager.subscribe({\n            applicationServerKey: convertedVapidKey,\n            userVisibleOnly: true,\n        });\n    };\n\n    return {getSubscription};\n};\n"],"mappings":";;AAAA,IAAMA,CAAA,GAAwB,SAAxBA,EAAyBC,CAAA,EAAqC;IAChE,IAAMC,CAAA,GAAU,IAAIC,MAAA,EAAQ,IAAIF,CAAA,CAAaG,MAAA,GAAS,KAAK,CAAC;MACtDC,CAAA,IAAUJ,CAAA,GAAeC,CAAA,EAC1BI,OAAA,CAAQ,MAAM,GAAG,EACjBA,OAAA,CAAQ,MAAM,GAAG;MAEhBC,CAAA,GAAUC,MAAA,CAAOC,IAAA,CAAKJ,CAAM;MAC5BK,CAAA,GAAc,IAAIC,UAAA,CAAWJ,CAAA,CAAQH,MAAM;IAEjD,SAASQ,CAAA,GAAI,GAAGA,CAAA,GAAIL,CAAA,CAAQH,MAAA,EAAQ,EAAEQ,CAAA,EACtBF,CAAA,CAAAE,CAAA,IAAKL,CAAA,CAAQM,UAAA,CAAWD,CAAC;IAGlC,OAAAF,CAAA;EACX;EAiBaI,CAAA,GAAe,SAAfA,EAAAC,IAAA;IAAA,IAAkBd,CAAA,GAAAc,IAAA,CAAAC,SAAA;IAAA,OAyBpB;MAACC,eAAA;QAAA,IAAAC,gBAAA,GAAAC,iBAAA,eAAAC,mBAAA,GAAAC,IAAA,CAxBgB,SAAAC,QAAA;UAAA,IAAAjB,CAAA,EAAAK,CAAA;UAAA,OAAAU,mBAAA,GAAAG,IAAA,UAAAC,SAAAC,QAAA;YAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;cAAA;gBAAA,MAChB,EAAE,mBAAmBC,SAAA,KAAc,EAAE,iBAAiBpB,MAAA;kBAAAiB,QAAA,CAAAE,IAAA;kBAAA;gBAAA;gBAAA,MAChD;kBAAEE,SAAA,EAAW;gBAAA;cAAA;gBAAAJ,QAAA,CAAAE,IAAA;gBAAA,OAGIC,SAAA,CAAUE,aAAA,CAAcC,KAAA;cAAA;gBAA7C1B,CAAA,GAAAoB,QAAA,CAAAO,IAAA;gBAAA,IAED3B,CAAA,CAAa4B,WAAA;kBAAAR,QAAA,CAAAE,IAAA;kBAAA;gBAAA;gBAAA,MACR;kBAAEE,SAAA,EAAW;gBAAA;cAAA;gBAAAJ,QAAA,CAAAE,IAAA;gBAAA,OAGYtB,CAAA,CAAa4B,WAAA,CAAYhB,eAAA,CAAgB;cAAA;gBAAA,KAAAQ,QAAA,CAAAO,IAAA;kBAAAP,QAAA,CAAAE,IAAA;kBAAA;gBAAA;gBAAA,MAGlE;kBAAEE,SAAA,EAAW;gBAAA;cAAA;gBAGjBnB,CAAA,GAAoBV,CAAA,CAAsBC,CAAS;gBAAAwB,QAAA,CAAAE,IAAA;gBAAA,OAC5CtB,CAAA,CAAa4B,WAAA,CAAYC,SAAA,CAAU;kBAC5CC,oBAAA,EAAsBzB,CAAA;kBACtB0B,eAAA,EAAiB;gBAAA,CACpB;cAAA;gBAAA,OAAAX,QAAA,CAAAY,MAAA,WAAAZ,QAAA,CAAAO,IAAA;cAAA;cAAA;gBAAA,OAAAP,QAAA,CAAAa,IAAA;YAAA;UAAA,GAAAhB,OAAA;QAAA;QAAA,SAAAL,gBAAA;UAAA,OAAAC,gBAAA,CAAAqB,KAAA,OAAAC,SAAA;QAAA;QAAA,OAAAvB,eAAA;MAAA;IAGkB;EAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}